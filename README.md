# Apple Pay + Adyen - Render Ready Example (Full)

## Summary
This repository is a minimal, ready-to-run example integrating Apple Pay (Web) with Adyen Checkout. It's prepared to run locally for development and to be deployed to Render.com using the included `Dockerfile` and `render.yaml`.

**Contents**
- `index.js` — Node/Express backend (serves the frontend and exposes Adyen-related endpoints)
- `public/` — static frontend (HTML + Apple Pay wiring)
- `.well-known/apple-developer-merchantid-domain-association` — placeholder for Apple merchant file (if you use your own merchant cert)
- `Dockerfile` — production Dockerfile for Render
- `render.yaml` — sample Render service configuration (you must set env vars in Render dashboard)
- `.env.example` — example environment variables
- `.gitignore`

## Prerequisites
- Adyen Sandbox account with Apple Pay enabled for your merchant account.
- Adyen API key with Checkout permissions.
- Public HTTPS domain (ngrok/localtunnel or a real domain) for Apple Pay merchant validation. Register that domain in Adyen Customer Area.
- An iPhone with Safari + Wallet for manual testing (for full E2E).

## Local quick run
1. Clone or extract this repository.
2. Copy `.env.example` to `.env` and fill in your values:
   ```
   ADYEN_API_KEY=YOUR_ADYEN_TEST_API_KEY
   ADYEN_MERCHANT_ACCOUNT=YOUR_ADYEN_MERCHANT_ACCOUNT
   PORT=3000
   ADYEN_CHECKOUT_BASE=https://checkout-test.adyen.com/v67
   ```
3. Install dependencies:
   ```bash
   npm ci
   ```
4. Start the server:
   ```bash
   npm start
   ```
5. Expose the frontend via HTTPS (for Apple Pay) — example using ngrok:
   ```bash
   ngrok http 3000
   ```
   Register the HTTPS hostname generated by ngrok (e.g. `abcd-1234.ngrok.io`) in the Adyen Customer Area under Apple Pay domains.
6. Open the HTTPS URL in Safari on your iPhone and click **Pay with Apple Pay**.

## Deploy to Render
1. Push this repository to GitHub.
2. Create a new Web Service on Render and connect to the repo (or use the `render.yaml` for Infrastructure-as-Code).
3. Configure environment variables in Render:
   - ADYEN_API_KEY
   - ADYEN_MERCHANT_ACCOUNT
   - PORT (optional)
4. Deploy. Render will build the Docker image using the `Dockerfile`.

## Notes & Security
- Do not commit your real API keys or merchant certificates to version control.
- For production, use your Apple Merchant Identity certificate and perform merchant validation with Apple on the server (instead of Adyen-managed sessions).
- Apple Pay requires HTTPS and a registered domain for merchant validation.

## References
- Adyen Apple Pay docs: https://docs.adyen.com/payment-methods/apple-pay
- Apple Pay on the Web: https://developer.apple.com/documentation/apple_pay_on_the_web
